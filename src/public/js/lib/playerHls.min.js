var varSaveBookmar;
var inicioBokmark = true;
var segundosVistos = 0;
var timeDelay = 500;

function initCallBackPLayerHls() {
    $(".fullback").off("click");
    $(".fullback").click(function () {
        DescargaPlayer();
        window.history.back();
        saveBookMark();
        setStopBookmark()
    });
    $(".itemLenguaje").off("click");
    $(".itemLenguaje").click(function () {
        saveBookMark();
        var urlPLayer = $(this).attr("data-info");
        var video = document.getElementById("videoVideo");
        var timeCurrent = video.currentTime;
        OpenHls(urlPLayer, timeCurrent);
        $("#ContenedorIdiomas").toggle(200)
    });
    if (inicioBokmark) {
        varSaveBookmar = setInterval(function () {
            setStartBookmark()
        }, 15E3);
        inicioBokmark = false
    }
}

function setScreenSize() {
    var AnchoTotal = $(window).width();
    if (AnchoTotal < 800) AnchoTotal = 800;
    $(".contenedorVideoPlugin").width(AnchoTotal);
    var AltoProporcional = AnchoTotal * .56;
    if (AltoProporcional > $(window).height()) AltoProporcional = $(window).height() - 5;
    else {
        var margenTop = ($(window).height() - AltoProporcional) / 2;
        $(".contenedorVideoPlugin").css("margin-top", margenTop + "px")
    }
    $(".ViewRightControlVOD").width(AnchoTotal);
    $(".ViewRightControlVOD").height(AltoProporcional - 75);
    $(".contenedorVideoPlugin").height(AltoProporcional)
}
var activeHls = true;
var hls = null;

function stopReprod(pagina) {
    if (pagina === "GuiaHorarioNueva.htm");
    else if (activeHls === false && hls != null) {
        hls.destroy();
        hls = null;
        activeHls = true
    }
}

function stopPlayer() {
    if (activeHls === false && hls != null) {
        hls.destroy();
        hls = null;
        activeHls = true
    }
}

function OpenHls(mrl, segundos) {
    try {
        if (Hls.isSupported()) {
            var video = document.getElementById("videoVideo");
            if (activeHls) {
                activeHls = false;
                hls = new Hls
            }
            hls.detachMedia();
            hls.loadSource(mrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                video.play()
            });
            hls.on(Hls.Events.ERROR, function (event, data) {
                switch (data.details) {
                    case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:
                        if (data.response.code === 0);
                        else console.log("No se pudo cargar el video.");
                        break
                }
            })
        } else console.log("no es soportado HLS");
        if (segundos > 0) {
            setTimeout(setPositionVideo, 750, segundos);
            segundosVistos = segundos
        } else setTimeout(setPositionVideo, 750, segundosVistos)
    } catch (e) {
        console.log("Error-openHLS:" + e, e)
    }
}

function playPausaHls() {
    var video = document.getElementById("videoVideo");
    if (video.paused === true) {
        video.play();
        $(".BTplay").addClass("BTpausa");
        $(".BTpausa").removeClass("BTplay")
    } else {
        video.pause();
        $(".BTpausa").addClass("BTplay");
        $(".BTplay").removeClass("BTpausa")
    }
}

function fullScreenHls() {
    var video = document.getElementById("videoVideo");
    if (video.requestFullscreen) video.requestFullscreen();
    else if (video.mozRequestFullScreen) video.mozRequestFullScreen();
    else if (video.webkitRequestFullscreen) video.webkitRequestFullscreen()
}

function setStartBookmark() {
    saveBookMark()
}

function setStopBookmark() {
    clearInterval(varSaveBookmar)
}

function saveBookMark() {
    var bookMarkSave = getPositionVideo();
    if (bookMarkSave > 0) {
        this.idSb = $(".itemLenguaje").attr("data-sub");
        this.idLa = $(".itemLenguaje").attr("data-lan");
        this.idVod = $(".itemLenguaje").attr("data-kind");
        segundosVistos = bookMarkSave;
        $.ajax({
            type: "POST",
            url: ctx + "/VodGuardaBookmark.htm",
            data: {
                idVod: idVod,
                idLa: idLa,
                idSb: idSb,
                time: bookMarkSave
            },
            beforeSend: function () {},
            success: function (data) {},
            error: function (xhr, status, error) {}
        })
    } else;
}

function getPositionVideo() {
    var video = document.getElementById("videoVideo");
    var position = Math.ceil(video.currentTime) * 1E3;
    return position
}

function setPositionVideo(position) {
    var video = document.getElementById("videoVideo");
    if (position > 0) video.currentTime = position
};